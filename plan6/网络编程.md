# TCP/IP网络模型

不同设备上的进程间通信



## 应用层

为用户提供应用功能，比如HTTP、FTP、Telnet、DNS、SMTP等



## 传输层

应用层的数据包会传给传输层，传输层是为应用层提供网络支持的，实现应用到应用间的通信

<img src="/home/noregret/.config/Typora/typora-user-images/image-20240516223206235.png" alt="image-20240516223206235" style="zoom: 33%;" />

协议：数据在网络中传输的规则，常见的协议有UDP、TCP、http、https、ftp

### UDP协议

#### 用户数据报协议

UDP是面向无连接通信协议（不保证数据包是否能抵达对方）

速度快，有大小限制一次最多发送64K，数据不安全，易丢失数据



#### 发送数据

1. 创建发送端的`DatagramSocket`对象
2. 数据打包（DatagramPacket)
3. 发送数据
4. 释放资源



#### 接受数据

1. 创建接收端的DatagramSocket对象
2. 接收打包好的数据
3. 解析数据包
4. 释放资源



### TCP协议

传输控制协议

TCP协议是面向连接的通信协议(需要先与对方建立连接然后才能发生数据)

TCP 相比 UDP 多了很多特性，比如流量控制、超时重传、拥塞控制等，这些都是为了保证数据包能可靠地传输给对方

应用需要传输的数据可能会非常大，如果直接传输就不好控制，因此当传输层的数据包大小超过 MSS（TCP 最大报文段长度） ，就要将数据包分块，这样即使中途有一个分块丢失或损坏了，只需要重新发送这一个分块，而不用重新发送整个数据包。在 TCP 协议中，我们把每个分块称为一个 **TCP 段**（*TCP Segment*）。

<img src="/home/noregret/.config/Typora/typora-user-images/image-20240516223524713.png" alt="image-20240516223524713" style="zoom: 33%;" />

### 端口号

端口号：应用程序在设备中唯一的标识

​		由两个字节表示的整数，取值范围：0~65535

​		其中0~1023之间的端口号用于一些知名的网络服务或者应用

​		我们自己使用1024以上的端口号就可以了

**！！！一个端口号只能被一个应用程序使用**



## 网络层

负责将数据从一个设备传输到另一个设备。

<img src="/home/noregret/.config/Typora/typora-user-images/image-20240519215642579.png" alt="image-20240519215642579" style="zoom: 33%;" />

### IP协议

IP协议会将传输层的报文作为数据部分，再加上IP包头组装成IP报文，如果 IP 报文大小超过 MTU（以太网中一般为 1500 字节）就会**再次进行分片**，得到一个即将发送到网络的 IP 报文。



### IP地址

设备在网络中的地址，是唯一的标识



### IPv4

全称：Internet Protocol version 4，互联网通信协议第四版

采用32位地址长度，分为4组，比如192.168.100.1

IP地址具有两种意义：

- 一个是**网络号**，负责表示该IP地址是属于哪个「子网」的
- 一个是**主机号**，负责标识同一「子网」下的不同主机

区分：借助**子网掩码**

> 10.100.122.2
>
> 子网掩码：24（255.255.255.0）
>
> 将10.100.122.2和255.255.255.0进行**按位与运算**，得到网络号
>
> 将255.255.255.0取反后与IP地址进行**按位与运算**，得到主机号

寻址：先匹配到相同的网络号（表示要找到同一个子网），再去找对应的主机

除了寻址能力， IP 协议还有另一个重要的能力就是**路由**。实际场景中，两台设备并不是用一条网线连接起来的，而是通过很多网关、路由器、交换机等众多网络设备连接起来的，那么就会形成很多条网络的路径，因此当数据包到达一个网络节点，就需要通过路由算法决定下一步走哪条路径。



### **地址分类形式**

公网地址（万维网使用）和私有地址（局域网使用）

192.168.开头的就是私有地址，范围为192.168.0.0--192.168.255.255，专门为组织机构内部使用，以此节省IP

### 特殊IP地址

127.0.0.1，也可以是localhost：是回送地址也称本地回环地址，也称本机IP，永远只会寻找当前所在本机

### 常用的CMP命令

`ipconfig`：查看本机IP地址

`ping`：检查网络是否连通



`InetAddress`：表示IP地址的类



### IPv6

采用128位地址长度，分为8组



## 网络接口层

生成了 IP 头部之后，接下来要交给**网络接口层**（*Link Layer*）在 IP 头部的前面加上 MAC 头部，并封装成数据帧（Data frame）发送到网络上。



<img src="/home/noregret/.config/Typora/typora-user-images/image-20240519225438185.png" alt="image-20240519225438185" style="zoom:33%;" />

什么是以太网呢？电脑上的以太网接口，Wi-Fi接口，以太网交换机、路由器上的千兆，万兆以太网口，还有网线，它们都是以太网的组成部分。以太网就是一种在「局域网」内，把附近的设备连接起来，使它们之间可以进行通讯的技术。

以太网通过匹配MAC头部判断网络包目的地。

MAC头部是以太网使用的头部，它包含了接收方和发送方的 MAC 地址等信息，我们可以通过 ARP 协议获取对方的 MAC 地址。



## 总结

综上所述，TCP/IP 网络通常是由上到下分成 4 层，分别是**应用层，传输层，网络层和网络接口层**。

<img src="/home/noregret/.config/Typora/typora-user-images/image-20240519231026417.png" alt="image-20240519231026417" style="zoom:33%;" />

每一层的封装格式：

<img src="/home/noregret/.config/Typora/typora-user-images/image-20240519231053942.png" alt="image-20240519231053942" style="zoom:33%;" />
