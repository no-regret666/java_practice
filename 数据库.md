# 数据库

## 数据库的基本概念

1. 数据库：`DataBase`    简称：DB

2. 什么是数据库？

​	用于存储和管理数据的仓库。

3. 数据库的特点：
   1. 持久化存储数据的。其实数据库就是一个文件系统。
   2. 方便存储和管理数据。
   3. 使用了统一的方式操作数据库。  --`SQL`
4. 常见的数据库软件

​	参见《`MYSQL`基础.pdf》



## `MySQL`数据模型

关系型数据库：建立在关系模型基础上，由多张相互连接的二维表组成的数据库

特点：

1. 使用表存储数据，格式统一，便于维护
2. `使用SQL`语言操作，标准统一，使用方便，可用于复杂查询

客户端--`SQL`-->`DBMS`(数据库管理系统)----->数据库---->表



## `SQL`

1. 什么是`SQL`?

   Structured Query Language：结构化查询语言

   其实就是定义了操作所有关系![image-20240602203646023](/home/noregret/.config/Typora/typora-user-images/image-20240602203646023.png)型数据库的规则。每一种数据库操作的方式存在不一样的地方，成为“方言”

2. `SQL`通用语法

   1. `SQL`语句可以单行或多行书写，以分号结尾

   2. 可使用空格和缩进来增加语句的可读性

   3. `MySQL`数据库的`SQL`语句不区分大小写

   4. 3种注释

      单行注释：-- 注释内容(--后加空格) 或 #注释内容(加不加空格都可以)   (`MySQL`特有)

      多行注释：/* 注释 */

3. 分类：`DDL` `DML` `DQL` `DCL`



### `DDL`

Data Definition Language，数据定义语言，用来定义数据库对象（数据库、表）

#### 数据库操作

`show databases;`：查询所有数据库

`create database [if not exists] 数据库名;`：创建数据库

`use 数据库名;`：使用数据库

`select database();`：查询当前数据库

`drop database [if exists] 数据库名;`：删除数据库

> 上述语法中的database，也可以替换成schema



#### 表结构操作

创建

```sql
create table 表名(
	字段1 字段类型 [约束] [comment 字段1注释],
    ...
    字段n 字段类型 [约束] [c是一款优秀的omment 字段n注释]
)[comment 表注释]
```

约束：

- 概念：约束是作用于表中字段上的规则，用于限制存储在表中的数据
- 目的：保证数据库中数据的正确性、有效性和完整性

![image-20240531220153701](/home/noregret/.config/Typora/typora-user-images/image-20240531220153701.png)



# `MyBatis`

`MyBatis`是一款优秀的**持久化**框架，用于简化`JDBC`的开发。

快速入门程序步骤：

1. 准备工作（创建`springboot`工程、数据库表、实体类）
2. 引入`Mybatis`的相关依赖，配置`Mybatis`（数据库连接信息）
3. 编写`SQL`语句（注解/XML）
4. 单元测试



## `JDBC`介绍

`JDBC`，就是使用Java数据操作关系型数据库的一套API。

 缺点：

- 硬编码
- 繁琐
- 资源浪费，性能降低



## 数据库连接池

- 数据库连接池是个容器，负责分配、管理数据库连接
- 它允许应用程序重复使用一个现有的数据库连接，而不是再建立一个
- 释放空闲时间超过最大空闲时间的连接，来避免因为没有释放连接而引起的数据库连接遗漏

优势：

- 资源重用
- 提升系统响应速度
- 避免数据库连接遗漏



## `lombok`工具包

`Lombok`是一个实用的Java类库，能通过注解的形式自动生成构造器，getter/setter、equals、hashcode、toString等方法，并可以自动化生成日志变量，简化java开发，提高效率。

![image-20240603220531078](/home/noregret/.config/Typora/typora-user-images/image-20240603220531078.png)



## 基础操作

### 删除

- `SQL`语句：

  ```sql
  delete from emp where id = 17;
  ```

- 接口方法：

  ```java
  @Delete("delete from emp where id = #{id}") //#{}占位符
  public void delete(Integer id);
  ```

![image-20240603222152874](/home/noregret/.config/Typora/typora-user-images/image-20240603222152874.png)

占位符预编译`SQL`优势：

- 性能更高

  ![image-20240603222951777](/home/noregret/.config/Typora/typora-user-images/image-20240603222951777.png)

- 更安全（防止`SQL`注入）

```sql
-- 密码为' or '1'='1
select count(*) from emp where username = '***' and password = '' or '1'='1'; 
-- or后的表达式永远成立
```



### 新增（主键返回）

- 在数据添加成功后，需要获取插入数据库数据的主键。

- 实现：

  ![image-20240603223305364](/home/noregret/.config/Typora/typora-user-images/image-20240603223305364.png)



### 更新

- `SQL`语句：

  <img src="/home/noregret/.config/Typora/typora-user-images/image-20240603223448754.png" alt="image-20240603223448754" style="zoom:50%;" />

- 接口方法：

  <img src="/home/noregret/.config/Typora/typora-user-images/image-20240603223516237.png" alt="image-20240603223516237" style="zoom:50%;" />



### 查询（根据ID查询）

- `SQL`语句：

  ```sql
  select * from emp where id = 19;
  ```

- 接口方法：

  ```java
  @Select("select * from emp where id = #{id}")
  public Emp getById(Integer id);
  ```

结果：实体类属性名和数据库表查询返回的字段名不一致的数据结果为NULL

#### 数据封装

- 实体类属性名和数据库表查询返回的字段名一致，`mybatis`会自动封装
- 如果实体类属性名和数据库表查询返回的字段名不一致，不能自动封装

解决方案：

- 起别名：在`SQL`语句中，对不一样的列名起别名，别名和实体类属性名一样

- 手动结果映射：通过@Results及@Result进行手动结果映射

- 开启驼峰命名（建议）：如果字段名与属性名符合驼峰命名规则，`mybatis`会自动通过驼峰命名规则映射。

  ```properties
  #开启驼峰命名自动映射，即从数据库字段名a_column映射到Java属性名aColumn
  mybatis.configuration.map-underscore-to-camel-case=true
  ```

  

### 查询（条件查询）

- `SQL`语句：

  ```sql
  select * from emp where name like '%张%';
  ```

- 接口方法：

  ```java
  @Select("select * from emp where name like '%${name}%'")
  public List<Emp> list(String name);
  ```

  `${}`生成的不是预编译的`SQL`，因此有性能低，不安全，存在`SQL`注入问题的缺点

  推荐使用`concat`（拼接字符串函数）：

  ```java
  @Select("select * from emp where name like concat('%',#{name},'%')")
  public List<Emp> list(String name);
  ```

  

